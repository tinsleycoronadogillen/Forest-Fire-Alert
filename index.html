<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Early Fire & Smoke Detection AI</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Montserrat", sans-serif;
            margin: 0;
            background: #f5f5f7;
            color: #222;
        }

        header {
            background: linear-gradient(135deg, #d32f2f, #9a0007);
            padding: 50px 20px;
            text-align: center;
            color: white;
            box-shadow: 0 3px 10px rgba(0,0,0,0.25);
        }

        header h1 {
            margin: 0;
            font-size: 2.6rem;
        }

        main {
            max-width: 1100px;
            margin: auto;
            padding: 30px;
        }

        .section {
            background: white;
            padding: 25px 35px;
            border-radius: 12px;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: 0.25s;
        }
        .section:hover {
            transform: translateY(-3px);
        }

        h2 {
            color: #b71c1c;
            margin-top: 0;
        }

        button {
            padding: 12px 20px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 12px;
            transition: 0.25s;
        }
        button:hover {
            background: #b71c1c;
            transform: scale(1.05);
        }

        #webcam-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }

        #label-container {
            margin-top: 20px;
            font-size: 1.1rem;
        }

        /* Upload box */
        .upload-box {
            border: 2px dashed #bdbdbd;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            margin-top: 25px;
            transition: 0.3s;
            background: #fafafa;
        }
        .upload-box:hover {
            background: #ffecec;
            border-color: #d32f2f;
        }

        img#preview {
            max-width: 350px;
            margin-top: 20px;
            display: none;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        #loading {
            display: none;
            margin-top: 15px;
            font-weight: bold;
            color: #b71c1c;
        }
    </style>
</head>

<body>

<header>
    <h1>Early Fire & Smoke Detection AI</h1>
    <p>Real-time detection using Google Teachable Machine</p>
</header>

<main>

    <!-- ABOUT PROJECT -->
    <div class="section">
        <h2>About This Project</h2>
        <p><strong>Project Title:</strong> Early Fire/Smoke Detection</p>
        <p>
            This project connects to the problem of detecting fires early in environments where traditional
            smoke detectors cannot easily be installed—such as forests, wildlife areas, and remote parks.
            The goal is to identify <strong>No Fire</strong>, <strong>Smoke</strong>, and <strong>Fire</strong>
            using AI to alert personnel before a small issue becomes a major wildfire.
        </p>
        <p>
            The intended users include organizations that monitor forests, national parks, and other
            fire-prone environments. Early intervention can reduce damage, prevent crises, and save
            wildlife and human communities.
        </p>
    </div>

    <!-- HOW IT WORKS -->
    <div class="section">
        <h2>How the AI Works</h2>
        <p>
            The model was created using <strong>Google Teachable Machine</strong>. Images of the three classes
            (No Fire, Smoke, Fire) were uploaded to train a machine-learning model.
        </p>
        <p>
            Teachable Machine converts the training data into an image recognition model that runs 
            directly in your browser using <strong>TensorFlow.js</strong>. No webcam or uploaded images
            leave your device—everything is processed locally and securely.
        </p>
    </div>

    <!-- INSTRUCTIONS -->
    <div class="section">
        <h2>Instructions</h2>
        <ol>
            <li>Press <strong>Start Webcam</strong> to detect fire or smoke in real time.</li>
            <li>OR upload an image using the <strong>Upload Image</strong> box below.</li>
            <li>The system will display predictions for each class.</li>
        </ol>
    </div>

    <!-- MODEL SECTION -->
    <div class="section">
        <h2>Fire/Smoke Detection Model</h2>

        <button onclick="startWebcam()">Start Webcam</button>
        <button onclick="stopWebcam()">Stop Webcam</button>

        <div id="webcam-container"></div>
        <div id="label-container"></div>
        <div id="loading">Loading model, please wait…</div>

        <div class="upload-box">
            <p><strong>Or upload an image:</strong></p>
            <input type="file" accept="image/*" onchange="handleFile(event)">
            <img id="preview" />
        </div>
    </div>

</main>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
    const MODEL_URL = "./my_model/"; // Place model folder next to this HTML file
    let model, webcam, maxPredictions, labelContainer;
    let webcamRunning = false;

    /* Load model on demand */
    async function loadModel() {
        if (model) return model;

        document.getElementById("loading").style.display = "block";

        const modelURL = MODEL_URL + "model.json";
        const metadataURL = MODEL_URL + "metadata.json";

        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        // Prepare prediction labels
        labelContainer = document.getElementById("label-container");
        labelContainer.innerHTML = "";
        for (let i = 0; i < maxPredictions; i++)
            labelContainer.appendChild(document.createElement("div"));

        document.getElementById("loading").style.display = "none";
        return model;
    }

    /* Webcam functions */
    async function startWebcam() {
        await loadModel();

        webcam = new tmImage.Webcam(300, 300, true);
        await webcam.setup();
        await webcam.play();
        webcamRunning = true;

        document.getElementById("webcam-container").innerHTML = "";
        document.getElementById("webcam-container").appendChild(webcam.canvas);

        requestAnimationFrame(webcamLoop);
    }

    function stopWebcam() {
        if (webcam) {
            webcam.stop();
            webcamRunning = false;
        }
    }

    async function webcamLoop() {
        if (!webcamRunning) return;
        webcam.update();
        await predict(webcam.canvas);
        requestAnimationFrame(webcamLoop);
    }

    /* File Upload */
    async function handleFile(event) {
        stopWebcam(); // Stop webcam if running
        await loadModel();

        const file = event.target.files[0];
        const img = document.getElementById("preview");

        img.src = URL.createObjectURL(file);
        img.style.display = "block";

        img.onload = async () => {
            await predict(img);
        };
    }

    /* Prediction Function */
    async function predict(input) {
        const prediction = await model.predict(input);
        for (let i = 0; i < maxPredictions; i++) {
            labelContainer.childNodes[i].innerHTML =
                `${prediction[i].className}: ${prediction[i].probability.toFixed(2)}`;
        }
    }
</script>

</body>
</html>
