<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Early Fire & Smoke Detection â€“ Teachable Machine Model</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f6f6f6;
      color: #222;
    }

    header {
      background: #d84315;
      color: white;
      padding: 20px;
      text-align: center;
    }

    section {
      width: 90%;
      max-width: 900px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h2 {
      color: #d84315;
    }

    #webcam-container, 
    #label-container,
    #uploaded-image-container,
    #upload-label-container {
      margin-top: 20px;
      text-align: center;
    }

    button {
      background: #d84315;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      margin: 5px;
    }

    button:hover {
      background: #bf3a10;
    }

    img {
      max-width: 300px;
      border-radius: 8px;
    }
  </style>

  <!-- Load Teachable Machine libraries -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
</head>

<body>

<header>
  <h1>Early Fire & Smoke Detection</h1>
  <p>A Teachable Machine model designed to detect smoke and flames in fire-prone outdoor areas.</p>
</header>

<section>
  <h2>ðŸš¨ Project Idea</h2>
  <p>
    Forests, parks, and remote outdoor zones are difficult places to install traditional smoke detectors. 
    Cameras, however, can be placed almost anywhere. This project uses a machine-learning model to watch 
    live camera feeds and detect early signs of firesâ€”helping organizations react before a dangerous 
    outbreak grows.
  </p>
</section>

<section>
  <h2>ðŸ§  How the Model Works</h2>
  <p>
    The system uses a <strong>Teachable Machine image classification model</strong> trained to distinguish:
  </p>
  <ul>
    <li>Flames</li>
    <li>Smoke</li>
    <li>Safe/normal scenes</li>
  </ul>
  <p>
    The webcam feed is analyzed frame-by-frame. When the model detects smoke or fire with high confidence, 
    the system can send alerts to notify forest managers or environmental protection teams.
  </p>
</section>

<section>
  <h2>ðŸ“¸ Try It Yourself</h2>
  <p>
    1. Press <strong>Start</strong> to load the model and activate your webcam.  
    <br>
    2. Or upload an image to test the model manually.
  </p>

  <!-- WEB CAM MODE -->
  <div>Teachable Machine Image Model</div>
  <button type="button" onclick="init()">Start Webcam</button>
  <div id="webcam-container"></div>
  <div id="label-container"></div>

  <hr style="margin: 40px 0;">

  <!-- IMAGE UPLOAD MODE -->
  <h3>Or Upload an Image</h3>
  <button onclick="document.getElementById('imageUpload').click()">Upload Image</button>
  <input 
      type="file" 
      id="imageUpload" 
      accept="image/*" 
      style="display:none" 
      onchange="handleImageUpload(event)"
  >

  <div id="uploaded-image-container">
      <img id="uploaded-image" src="" style="display:none;">
  </div>
  <div id="upload-label-container"></div>

</section>

<script type="text/javascript">
// ==========================================================
//   TEACHABLE MACHINE MODEL SETUP
// ==========================================================

const URL = "./my_model/";

let model, webcam, labelContainer, maxPredictions;

// Load the model and set up the webcam
async function init() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    model = await tmImage.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();

    const flip = true; 
    webcam = new tmImage.Webcam(200, 200, flip); 
    await webcam.setup();
    await webcam.play();
    window.requestAnimationFrame(loop);

    document.getElementById("webcam-container").appendChild(webcam.canvas);
    labelContainer = document.getElementById("label-container");
    labelContainer.innerHTML = "";
    for (let i = 0; i < maxPredictions; i++) {
        labelContainer.appendChild(document.createElement("div"));
    }
}

// Loop for webcam prediction
async function loop() {
    webcam.update();
    await predict();
    window.requestAnimationFrame(loop);
}

// Predict from webcam
async function predict() {
    if (!model) return;
    const prediction = await model.predict(webcam.canvas);
    for (let i = 0; i < maxPredictions; i++) {
        const classPrediction =
            prediction[i].className + ": " + prediction[i].probability.toFixed(2);
        labelContainer.childNodes[i].innerHTML = classPrediction;
    }
}

// ==========================================================
//   IMAGE UPLOAD FEATURE
// ==========================================================

function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const img = document.getElementById("uploaded-image");
    img.src = URL.createObjectURL(file);
    img.style.display = "block";

    img.onload = () => predictImage(img);
}

async function predictImage(imageElement) {
    if (!model) {
        alert("Please click 'Start Webcam' at least once to load the model.");
        return;
    }

    const prediction = await model.predict(imageElement);

    const uploadLabelContainer = document.getElementById("upload-label-container");
    uploadLabelContainer.innerHTML = "";

    for (let i = 0; i < prediction.length; i++) {
        const label = document.createElement("div");
        label.innerHTML = `${prediction[i].className}: ${prediction[i].probability.toFixed(2)}`;
        uploadLabelContainer.appendChild(label);
    }
}
</script>

</body>
</html>
