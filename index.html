<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Early Fire & Smoke Detection – Teachable Machine</title>

    <!-- Fonts + styling -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Inter", sans-serif;
            margin: 0;
            background: #f4f4f7;
            color: #222;
        }
        header {
            background: #c62828;
            color: white;
            padding: 30px;
            text-align: center;
        }
        main {
            max-width: 900px;
            margin: auto;
            padding: 20px;
        }
        h2 {
            color: #c62828;
            margin-top: 40px;
        }

        .section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        button {
            background: #c62828;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background: #a91f1f;
        }

        #webcam-container, #label-container {
            margin-top: 15px;
        }

        .upload-area {
            margin-top: 20px;
            padding: 20px;
            border: 2px dashed #bbb;
            border-radius: 8px;
            text-align: center;
            background: #fafafa;
        }

        img#uploaded-image {
            max-width: 300px;
            margin-top: 15px;
            display: none;
        }
    </style>
</head>

<body>
<header>
    <h1>Early Fire & Smoke Detection System</h1>
    <p>AI-powered detection using Google Teachable Machine</p>
</header>

<main>
    <!-- ---------- PROJECT OVERVIEW ---------- -->
    <section class="section">
        <h2>About This Project</h2>
        <p><strong>Project Title:</strong> Early Fire/Smoke Detection</p>
        <p>
            This project addresses the need for early fire detection in places where traditional smoke
            detectors cannot easily be installed—such as forests, nature reserves, remote parks,
            and other large outdoor environments. By using camera feeds (webcams or trail cameras),
            this system can identify <strong>three classes: No Fire, Smoke, and Fire</strong>.
        </p>
        <p>
            The goal is to help organizations that manage forests, national parks, or other wildfire-prone
            environments detect danger sooner and potentially reduce the severity of wildfires.
        </p>
        <p>
            When smoke or flames are detected, this system can be connected to alert tools (SMS, email,
            monitoring dashboards) to warn staff about possible fire hazards.
        </p>
    </section>

    <!-- ---------- HOW THE TEACHABLE MACHINE WORKS ---------- -->
    <section class="section">
        <h2>How the Teachable Machine Model Works</h2>
        <p>
            Google’s <strong>Teachable Machine</strong> allows anyone to train an image classification model
            without writing code. You simply upload example images for each class (No Fire, Smoke, Fire), 
            and the tool learns the visual patterns that distinguish them.
        </p>
        <p>
            After training, Teachable Machine exports a model that runs directly in your browser using
            TensorFlow.js. This means:
        </p>
        <ul>
            <li>No server processing required</li>
            <li>Your webcam feed stays private (nothing is uploaded)</li>
            <li>The detection runs in real time</li>
        </ul>
    </section>

    <!-- ---------- INSTRUCTIONS ---------- -->
    <section class="section">
        <h2>Instructions</h2>
        <ol>
            <li>Click <strong>Start Webcam</strong> to allow the AI to analyze your live camera feed.</li>
            <li>Or upload a photo using the <strong>Upload Image</strong> option.</li>
            <li>The AI will display the probabilities for: No Fire, Smoke, Fire.</li>
            <li>If “Fire” or “Smoke” probabilities are high, the system would normally trigger an alert.</li>
        </ol>
    </section>

    <!-- ---------- TEACHABLE MACHINE INTERFACE ---------- -->
    <section class="section">
        <h2>Try the Fire/Smoke Detection Model</h2>

        <button type="button" onclick="init()">Start Webcam</button>
        <button onclick="stopWebcam()">Stop Webcam</button>

        <div id="webcam-container"></div>
        <div id="label-container"></div>

        <div class="upload-area">
            <p><strong>Or upload an image:</strong></p>
            <input type="file" accept="image/*" onchange="handleImageUpload(event)">
            <img id="uploaded-image" />
        </div>
    </section>
</main>

<!-- ---------- SCRIPTS ---------- -->

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

<script>
    const URL = "./my_model/";
    let model, webcam, labelContainer, maxPredictions;
    let webcamRunning = false;

    // Initialize Webcam + Model
    async function init() {
        if (webcamRunning) return;

        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        const flip = true;
        webcam = new tmImage.Webcam(300, 300, flip);
        await webcam.setup();
        await webcam.play();
        webcamRunning = true;

        window.requestAnimationFrame(loop);

        document.getElementById("webcam-container").innerHTML = "";
        document.getElementById("webcam-container").appendChild(webcam.canvas);

        labelContainer = document.getElementById("label-container");
        labelContainer.innerHTML = "";
        for (let i = 0; i < maxPredictions; i++) {
            labelContainer.appendChild(document.createElement("div"));
        }
    }

    function stopWebcam() {
        if (webcam && webcam.webcam) {
            webcam.stop();
            webcamRunning = false;
        }
    }

    async function loop() {
        if (!webcamRunning) return;
        webcam.update();
        await predict(webcam.canvas);
        window.requestAnimationFrame(loop);
    }

    // ----- IMAGE UPLOAD PREDICTION -----
    async function handleImageUpload(event) {
        stopWebcam();

        const file = event.target.files[0];
        const img = document.getElementById("uploaded-image");

        img.src = URL.createObjectURL(file);
        img.style.display = "block";

        img.onload = async () => {
            if (!model) {
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
            }
            await predict(img);
        };
    }

    // ----- PREDICT FUNCTION -----
    async function predict(input) {
        const prediction = await model.predict(input);

        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            labelContainer.childNodes[i].innerHTML = classPrediction;
        }
    }
</script>

</body>
</html>
